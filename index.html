<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
	<title>Weather Forecast</title>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
	<link href="images/favicon.png" rel="icon" type="image/png" />
	<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" rel="stylesheet" /><script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>
<body>

<div class="container p-5 my-5 bg-danger text-white">
    <h1>Click the button get your weather forecast.</h1>
    <br>
    <h3>Note that you must allow your browser to know your location, but no data is stored on you!</h3>
    <br>
    <br>
    <button onclick="getLocation();buttonPressed()" type="button" class="btn btn-secondary btn-lg">Get My Forecast</button>
    <hr>

    <!-- place holders for data -->
    <p id="lat_location"></p>
    <p id="lon_location"></p>
    <p id="load"></p>
    <p id="forecast"></p>
</div>

<!-- Begin JavaScript -->
<script type="text/javascript">

    // Button press action
    function buttonPressed()
        {
            alert("Fetching Weather!");
        }

    // code to get geolocation
    function getLocation() {
        if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(geoSuccess);
            } else {
                alert("Geolocation is not supported by this browser.");
            }
    }
    function geoSuccess(position) {
        var lat = position.coords.latitude;
        var lng = position.coords.longitude;
        document.getElementById("lat_location").innerHTML="Latitude: "+ lat;
        document.getElementById("lon_location").innerHTML="Longitude: " + lng;

        var latitude = document.getElementById("lat_location").innerHTML;
        console.log("got it: " + latitude);
        var longitude = document.getElementById("lon_location").innerHTML;
        console.log("got it: " + longitude);
    var available = {
        "url": "https://api.weather.gov/points/" + lat + "," + lng,
    }

    // Begins populating the data onto the page
    document.getElementById("load").innerHTML="Loading... Fetching your perfect weather now."

    $.ajax(available).done(function (response){
        console.log(response.properties.forecast);
        var url= response.properties.forecast;
        $.ajax(url).done(function (response){
            console.log(response.properties.periods);
            for (i in response.properties.periods){
                var day = response.properties.periods[i].name;
                var forecast = response.properties.periods[i].detailedForecast;
                var getIcon = response.properties.periods[i].icon;
                var getPrecipitation = response.properties.periods[i].probabilityOfPrecipitation.value;
                var img = new Image();   // Create new img element
                img.src = getIcon; // Set source path
                $("#forecast").append("<h1>"+day+"<br>").append(img).append("<br>"+forecast).append("<br>Chance of precipitation: " + getPrecipitation +"%<hr>");
        document.getElementById("load").innerHTML = "<hr><h1>Here's your forecast: </h1>"

    };})})}
</script>
</body>
</html>